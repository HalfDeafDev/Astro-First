---
import BaseLayout from 'tutorial/layouts/BaseLayout.astro';

export function getUniqueTags() {
    const allPosts = Object.values(import.meta.glob('../posts/*.md', { eager: true }));
    return [...new Set(allPosts.map((post:any) => post.frontmatter.tags).flat())];
}

export async function getStaticPaths() {
    const allPosts = Object.values(import.meta.glob('../posts/*.md', { eager: true }));
    const param = (t:string) => { return {params: {tag: t}, props: {posts: allPosts}} }

    const params = getUniqueTags().map((p) => param(p));

    return params;
}

const { tag } = Astro.params;
const { posts } = Astro.props;
const filteredPosts = posts.filter((post : any) => post.frontmatter.tags?.includes(tag));
---

<BaseLayout pageTitle={tag}>
    <p>Posts tagged with {tag}</p>
    <ul>
        {
            filteredPosts.map((post : any) => (
                <li>
                    <a href={post.url}>{post.frontmatter.title}</a>
                </li>
            ))
        }
    </ul>
</BaseLayout>